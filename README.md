# Week 02. React Task (Slurm Навыкум "Build Containers!")

## Задача

Есть проект на React (исходники хранятся в этом каталоге), который представляет собой Frontend к одному из веб-сервисов

Так получилось, что разработчики запилили Frontend раньше, чем Backend, поэтому Backend'ерам нужно пилить и свою часть, и тестировать всё вместе

Поэтому они (Backend'еры) просят нас упаковать Frontend в Docker-образ, используя в качестве базы конечного образа [Nginx](https://hub.docker.com/_/nginx) версии 1.22 (alpine)

Для промежуточных этапов (сборка) необходимо использовать [Node Alpine LTS](https://hub.docker.com/_/node)

### Формулировка разработчика

Разработчик сказал следующее* (дословно):
> Frontend делает запросы на `/api`, поэтому нужно, чтобы данные запросы проксировались Nginx'ом на локальную машину, порт `9999` (именно там в среде разработчиков будет работать сервер, который мы и разрабатываем)
>
> При этом, IP машины разработчика может меняться, вплоть до того, что у него может не быть доступа к сети, поэтому нужен какой-то универсальный и понятный способ, без хитрых способов определения IP, возможно, у Docker есть какое-то готовое решение для таких сценариев (по крайней мере, так говорят коллеги)
>
> Для тестирования мы приложили "заглушку" сервиса в каталоге `server` (запускать через `node server/index.js`)
>
> Если при загрузке Frontend'а туда придёт запрос, то в консоль выведется сообщение
> 
> Сам сервер упаковывать в Docker-образ не нужно
> 
> Frontend должен отдаваться по HTTPS (хотя между Nginx и сервером пока будет HTTP), поэтому:
> 1. На сам Nginx надо поставить самоподписанный сертификат, сроком действия в 1 месяц (с даты сборки образа) на `127.0.0.1` и `local.dev` (приватный ключ и сертификат положить в `/etc/nginx/keys` в виде файлов `server.key` и `server.crt`, соответственно)
> 2. Сертификат генерировать отдельным шаго в сборке (нужен RSA 4096 бит)
> 2. Поддерживать нужно только TLS1.3 (поддержка 1.2 и 1.1 не требуется)
> 3. Редиректить с http на https (т.е. выставлять наружу нужно 80 и 443 порты)
>
> Конфигурация Nginx должна располагаться в файле `nginx.conf.template` и копироваться в `/etc/nginx/templates/default.conf.template`, дополнительных действий с конфигурацией производить не нужно

**Важно**: использовать образ планируется только для тестирования и локальной разработки (**не production**), поэтому будем считать, что упаковка в образ приватного ключа и доступ к хосту допустимы

Что нужно сделать:
> 1. Упаковать Frontend в Docker-образ, при этом распарралелить:
> - сборку приложения
> - тестирование приложения (линтинг не нужен)
> - генерацию приватного ключая и сертификата (берите образ Ubuntu LTS)
> 2. Выложить всё в виде публичного образа на GHCR (GitHub Container Registry), чтобы мы могли сами затестить и переиспользовать

Чего не нужно делать (дословно):
> Никаких `entrypoint.sh` и других sh-скриптов писать не нужно
> 
> Переделывать приложение (редактировать исходный код) тоже не нужно

### Требования

1. Всё должно быть оформлено в виде публичного репозитория на GitHub
2. Вся сборка образов должна проходить через GitHub Actions
3. Образ должен выкладываться в GitHub Container Registry (GHCR)

К текущему заданию дополнительно предъявляются требования:
1. [Docker Buildx Build](https://docs.docker.com/build/) (указывайте явно при сборке `docker buildx build`)
2. Multi-Stage

